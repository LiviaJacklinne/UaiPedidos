<div class="container">

  <h1>UaiPedidos</h1>

  <!-- AÇÕES -->
  <div class="actions">

    <!-- Buscar por ID -->
    <div class="search">
      <input class="input-id" type="text" placeholder="Buscar pedido por ID" [(ngModel)]="searchId" />
      <button class="btn-primary" (click)="buscarPorId()">Buscar</button>
      <button class="btn-secondary" (click)="limpar()">Limpar</button>
    </div>

    <!-- Criar -->
    <button class="btn-primary" (click)="abrirFormulario()">
      Novo Pedido
    </button>
  </div>

  <!-- TABELA -->
  <table class="table">
    <thead>
      <tr>
        <th class="id-col">ID</th>
        <th>Itens</th>
        <th class="total-col">Total</th>
        <th class="status-col">Status</th>
        <th>Ações</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let pedido of pedidos">
        <td class="id-col">{{ pedido.id }}</td>
        <td>
          <div *ngFor="let item of pedido.itens">
            {{ item.nomeProduto }} (x{{ item.quantidade }})
          </div>
        </td>

        <td class="total-col"> R$ {{ pedido.total }}</td>

        <td class="status-col">
          <span [ngClass]="pedido.status">{{ pedido.status }}</span>
        </td>

        <td class="actions-buttons">
          <div class="actions-wrapper">

            <!-- Se estiver CRIADO -->
            <ng-container *ngIf="pedido.status === 'CRIADO'">
              <button class="btn-aprovar" (click)="aprovar(pedido.id)">
                Aprovar
              </button>

              <button class="btn-cancelar" (click)="cancelar(pedido.id)">
                Cancelar
              </button>
            </ng-container>

            <!-- Se estiver APROVADO ou CANCELADO -->
            <ng-container *ngIf="pedido.status !== 'CRIADO'">
              <button class="btn-deletar" (click)="deletar(pedido.id)">
                Deletar
              </button>
            </ng-container>

          </div>
        </td>

      </tr>
    </tbody>
  </table>
</div>

<!-- ================= MODAL ================= -->
<div class="modal-backdrop" *ngIf="mostrarFormulario">

  <div class="modal">
    <h2>Novo Pedido</h2>

    <!-- LISTA DE ITENS -->
    <div class="itens-lista">
      <div class="item-row" *ngFor="let item of itensDisponiveis">
        <div class="item-info">
          <strong>{{ item.nome }}</strong>
          <span> R$ {{ item.preco }}</span>
        </div>

        <div class="item-actions">
          <button (click)="diminuirQuantidade(item)">-</button>
          <span>{{ item.quantidade }}</span>
          <button (click)="aumentarQuantidade(item)">+</button>
        </div>

        <div class="item-subtotal">
          R$ {{ item.preco * item.quantidade }}
        </div>
      </div>
    </div>

    <!-- TOTAL -->
    <div class="total">
      <strong>Total: R$ {{ calcularTotal() }}</strong>
    </div>

    <div class="form-buttons">
      <button class="btn-primary" (click)="salvarPedido()" [disabled]="calcularTotal() === 0">
        Confirmar Pedido
      </button>

      <button class="btn-secondary" (click)="cancelarFormulario()">
        Cancelar
      </button>
    </div>

  </div>
</div>